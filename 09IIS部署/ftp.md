## FTP服务器

### 简介

1. File Transfor Protocol 文件传输协议

2. 端口号:

   TCP 20/21

3. ftp工作方式: 主动模式和被动模式

4. ftp工作路径: `C:\Inetpub\ftproot`

5. ftp服务器也是需要用户登录的, 默认使用的是匿名登录, 用户是开启FPT服务时自动创建的．

### 修改默认站点

1. 右键默认站点, 点击主目录, 修改路径为 `D:\QQ`
2. 客户机输入`ftp://10.1.1.1`就可以看到 `D:\QQ`上的文件了

### 新建站点

新建站点,让该站点可以由admin 和 user两个账号访问, admin拥有最高权限, user 对upload文件夹只能上传, 对 download 文件夹只能下载.

1. 右键FTP站点, 新建FTP站点

2. 设置IP 10.1.1.1

3. 选择路径

4. 选择权限, 读取和写入

   ```
   在共享服务器中,文件的最终权限是文件的分享权限和NTFS权限的交集. 
   那么在FTP服务器中也是一样的，文件的权限是文件的FTP权限和NTFS权限交集．
   所以FTP权限就全开, 具体的权限限制在文件的NTFS权限中设置即可.
   ```

5. 取消匿名访问

6. 新建两个用户 user 和 admin 

7. 对两个文件夹 upload 和 download 设置不同的权限. 

   ```
   upload: 删除 users 组, 添加 user 和 admin 用户, admin 拥有完全控制权, user 具有列出文件夹目录和写入的权限.
   download: 删除 users 组, 添加 user 和 admin 用户, admin 拥有完全控制权, user 具有累出文件夹u路和读取权限.
   ```

### 模式

选择模式的权力是在客户机上的.

#### 主动模式

21端口: 控制端口

20端口: 数据端口

主动情况下,服务器开启21端口号,客户机在大于50000端口号中随机选择一个端口号, 如50001. 那么这个时候就是50001端口和21端口通信. 50001端口主动发起主动模式的连接请求, 当50001 端口发送要下载某个文件的端口时, 客户机会在开启一个端口如 50002端口用来接收数据,这时候服务器也会开启一个端口20会联系50002通信.

##### 注意

当开启了防火墙之后, 防火墙的目的就是防止其它主机与该主机的某些端口通信.但是由于主动模式的情况下, 客户机是会随即找一个端口让服务器进行通信. 但是当服务器用 20端口准备与50002端口通信时, 很有可能会被防火墙阻挡, 因为防火墙有可能禁止了50002端口的开放,就没办法进行通信了.

而50001可以与21端口进行通信这是因为, 50001是主动与21端口进行通信的, 可以理解为防火墙开启了50001端口.

#### 被动模式

客户机50001端口以被动模式的方式与服务器21端口通信. 当50001端口发送下载文件请求时. 21端口会发送一个端口号信息如20001端口给客户机, 目的就是告诉客户机, 需要数据与20001端口通信. 这个时候客户机开放随机端口50002端口与20001端口通信.

##### 注意

同样的问题, 在服务器有防火墙的情况下, 很有可能客户机50002端口不能与端口20001端口通信.

#### 模式选择

当服务器开了防火墙时, 最好使用主动模式;

当服务器没有开防火墙时, 两个模式都行.

最好就是选择主动模式, 因为这样服务器可以不用开放这么多端口, 因为被动模式的数据端口是随机的, 而主动模式的话, 服务器只需要开放 20 和 21 端口.

#### 总结

一般来说服务器是肯定会开防火墙的, 这个时候客户机再使用被动模式连接就不行了, 因为服务器数据端口是随机的, 防火墙不一定开放了这个端口.

这个时候我们应该使用主动模式, 虽然客户机也会生成随机的端口来作为数据传输, 但是客户机我们自己是可以关掉防火墙的, 如果传输不了, 就可以关掉防火墙.

**主被动模式, 选择权在客户机上; **

**主被动模式, 所谓主或被是站在服务器的角度;**

**主被动模式, 阐述的是数据传输过程**